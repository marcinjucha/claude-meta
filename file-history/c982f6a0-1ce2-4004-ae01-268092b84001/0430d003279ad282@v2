// Copyright Â© 2024 Scandit. All rights reserved.

import ComposableArchitecture
import SwiftUI

extension NavigationDestination {
    static let aisleModuleListView = Self(name: "AisleModuleListView")
    static let modulePreviewView = Self(name: "ModulePreviewView")
}

struct AisleModuleListView<RowContent: View>: View {
#if DEBUG
    @ObserveInjection private var forceRedraw
#endif

    let store: TCAStoreOf<AisleModuleListFeature>
    @ViewBuilder let rowContent: (PersistedShelfScanModule, PersistedShelfScanAisle) -> RowContent

    var body: some View {
        VStack {
            List {
                Section {
                    ForEach(store.modules) { module in
                        Button {
                            store.send(.onModuleButtonTapped(module: module))
                        } label: {
                            rowContent(module, store.aisle)
                        }
                    }
                }
            }

            if store.allowsModuleCreation {
                Section {
                    Button(L10n.Svm.AisleDetails.addModule) {
                        store.send(.onAddModuleButtonTapped)
                    }
                    .listRowInsets(EdgeInsets())
                    .scanditButtonStyle()
                }
            }
        }
        .onAppear {
            store.send(.onAppear)
        }
        .onDisappear {
            store.send(.onDisappear)
        }
        .scanditNavigationBar(title: store.aisleName)
        .enableInjection()
    }
}
