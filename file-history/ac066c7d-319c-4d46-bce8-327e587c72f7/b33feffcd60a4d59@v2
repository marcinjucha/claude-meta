# Claude Code Custom Commands - Usage Examples

This document provides practical examples for using custom Claude Code commands in the Scandit ShelfView iOS project.

## Available Commands

- `/debug` - Debug iOS + TCA code issues
- `/explain` - Explain iOS + TCA architecture
- `/lint` - Code quality analysis
- `/optimize` - Performance optimization
- `/refactor` - Architecture refactoring

---

## `/debug` - Debugging Konkretnych Problem√≥w

### Example A: State Not Updating
```bash
/debug DigitalShelf/Screens/Login/LoginFeature.swift State nie aktualizuje siƒô po zmianie email
```
**What it checks:**
- `@ObservableState` on State
- `BindingReducer()` in body
- View uses `@Bindable var store`
- TextField uses `$store.email`

### Example B: Crash During Async Operation
```bash
/debug Modules/Sources/Features/RouteList/RouteListFeature.swift App crashuje przy ≈Çadowaniu routes
```
**What it checks:**
- `@Dependency` not used in TaskGroup
- Effect has proper cancellation
- No force unwraps (!)
- Proper error handling

### Example C: Navigation Not Working
```bash
/debug DigitalShelf/Screens/Settings/SettingsFeature.swift Sheet siƒô nie pokazuje po klikniƒôciu logout
```
**What it checks:**
- `@Presents var destination` exists
- `PresentationAction` in Action enum
- `.ifLet(\.$destination, action: \.destination)` present
- View uses `.sheet($store.scope(...))`

---

## `/explain` - Understanding Existing Code

### Example A: Onboarding New Developer
```bash
/explain DigitalShelf/Screens/ShelfScan/MappingFlow/MappingFlowRootView.swift
```
**What you get:**
- State structure and data flow explanation
- How navigation works (@Presents, NavigationStack)
- Which Use Cases are used and why
- Lifecycle explanation (onAppear, onDisappear)

### Example B: Understanding Use Case
```bash
/explain Modules/Sources/Core/UseCases/RouteListUseCase.swift
```
**What you get:**
- Use Case responsibilities
- Which Services/Repositories it uses
- How Publisher pattern works
- Why it's a Use Case vs Service

### Example C: Code Review - Understanding PR
```bash
/explain DigitalShelf/Screens/ShelfScan/MappingFlow/ModulePreview/MappingModeModulePreviewFeature.swift
```
**What you get:**
- Complete architecture breakdown
- Explanation of each action and reducer
- How async loading works with Refreshable enum
- Integration with parent feature

---

## `/lint` - Quality Check Before Commit

### Example A: Pre-Commit Check Entire Feature
```bash
/lint DigitalShelf/Screens/ShelfScan/MappingFlow/MappingFlowStore.swift
```
**What it checks:**
- TCA patterns (ViewAction, BindingReducer, cancellation)
- Design system compliance (Colors, L10n)
- Architecture (no layer skipping)
- Code smells (duplication, complexity, hardcoded values)

### Example B: Review SwiftUI View
```bash
/lint DigitalShelf/Screens/Home/HomeView.swift
```
**What it checks:**
- Uses Colors enum instead of `.blue`, `.red`
- Uses `.defaultFont()` instead of `.system(size:)`
- Uses L10n instead of hardcoded strings
- Has accessibility labels
- Has InjectionIII support

### Example C: Review Use Case
```bash
/lint Modules/Sources/Core/UseCases/RouteListUseCase.swift
```
**What it checks:**
- Is in Business layer (not Data, not Presentation)
- Has `makeWithDeps` factory
- Uses proper dependency injection
- No UI logic

---

## `/optimize` - Performance Issues

### Example A: Scrolling Is Laggy
```bash
/optimize DigitalShelf/Screens/ScanHistory/ScanHistoryView.swift fix scrolling jank
```
**What it suggests:**
- LazyVStack instead of VStack
- IdentifiedArrayOf for list
- Minimize view body executions
- Proper image caching

### Example B: Long Startup Time
```bash
/optimize DigitalShelf/AppDelegate.swift reduce startup time
```
**What it suggests:**
- Defer heavy initialization
- Async loading of non-critical resources
- Database migration optimization
- Remove synchronous network calls

### Example C: Memory Usage Growing
```bash
/optimize Modules/Sources/Features/ShelfScan/ShelfScanFeature.swift reduce memory usage
```
**What it suggests:**
- Uncanceled effects (memory leaks)
- Retain cycles in publishers (use weakSink)
- State too large (move to Use Case)
- Image caching strategy

### Example D: Slow GRDB Query
```bash
/optimize Modules/Sources/Persistence/Repositories/RouteRepository.swift optimize route query
```
**What it suggests:**
- Add database indexes
- Batch operations instead of individual
- Use joins instead of N+1 queries
- Cache frequently accessed data

---

## `/refactor` - Architectural Improvements

### Example A: Massive Reducer - Split It
```bash
/refactor DigitalShelf/Screens/Settings/SettingsFeature.swift split reducer
```
**What it suggests:**
- Extract child features (Account, Preferences, About)
- ViewAction/ResponseAction/DelegateAction pattern
- Scope child features in body
- Navigation with @Presents

### Example B: Store Calls Repository - Broken Architecture
```bash
/refactor DigitalShelf/Screens/Home/HomeFeature.swift extract use case
```
**What it does:**
1. Creates `HomeUseCase` in Business layer
2. Moves business logic from Store to Use Case
3. Updates Store to use Use Case
4. Adds `makeWithDeps` factory

### Example C: Repository Calls Repository - Dependency Cycle
```bash
/refactor Modules/Sources/Persistence/Repositories/RouteRepository.swift create service
```
**What it does:**
1. Creates `RouteWithModulesService` in Business layer
2. Service combines RouteRepository + ModuleRepository
3. Use Case uses Service instead of Repository
4. Removes cycle

### Example D: Hardcoded Strings and Colors
```bash
/refactor DigitalShelf/Screens/Login/LoginView.swift apply design system
```
**What it does:**
1. Replace hardcoded strings ‚Üí L10n constants
2. Replace Color.blue ‚Üí Colors.blue60
3. Replace .system(size:) ‚Üí .defaultFont(size:, weight:)
4. Add accessibility labels

### Example E: Complex View - Extract Components
```bash
/refactor DigitalShelf/Screens/ShelfScan/CaptureView.swift extract components
```
**What it suggests:**
- Extract reusable views (CaptureButton, StatusBar)
- Break down massive body
- @ViewBuilder computed properties
- Move to CustomUI/ if reusable

---

## Command Combinations - Power User Workflows

### Workflow 1: Implementing New Feature
```bash
# 1. Implement feature
# ...

# 2. Lint before commit
/lint DigitalShelf/Screens/MyFeature/MyFeatureStore.swift

# 3. Fix issues
# ...

# 4. Run agents for comprehensive review (optional)
# Launch tca-developer + ios-architect agents in parallel
```

### Workflow 2: Debugging Production Issue
```bash
# 1. Debug specific error
/debug DigitalShelf/Screens/Checkout/CheckoutFeature.swift Payment fails with timeout error

# 2. If slow, optimize
/optimize DigitalShelf/Screens/Checkout/CheckoutFeature.swift reduce payment timeout

# 3. Explain to understand context
/explain Modules/Sources/Core/Services/PaymentService.swift
```

### Workflow 3: Code Review
```bash
# 1. Explain what changed
/explain path/to/changed/file.swift

# 2. Lint for quality
/lint path/to/changed/file.swift

# 3. Check if refactoring needed
/refactor path/to/changed/file.swift improve architecture
```

### Workflow 4: Performance Investigation
```bash
# 1. Profile slow screen
/optimize DigitalShelf/Screens/RouteList/RouteListView.swift fix slow rendering

# 2. Debug if crashes
/debug DigitalShelf/Screens/RouteList/RouteListFeature.swift Crashes when loading 100+ routes

# 3. Refactor if architecture issue
/refactor Modules/Sources/Persistence/Repositories/RouteRepository.swift optimize query
```

---

## Best Practices

### ‚úÖ DO:
- **Be specific** in error_description: `"State nie aktualizuje siƒô po klikniƒôciu"` instead of `"nie dzia≈Ça"`
- **Provide context** in refactor_goal: `"extract use case"` instead of `"improve"`
- **Use full paths**: `/debug DigitalShelf/...` instead of relative path
- **One concern at a time**: `/lint` for quality, `/optimize` for performance (don't mix)

### ‚ùå DON'T:
- **Generic requests**: `/debug file.swift` (what's not working?)
- **Multiple concerns**: `/refactor file.swift fix everything` (too broad)
- **Wrong command**: `/optimize` for architectural issues (use `/refactor`)
- **Missing context**: `/debug` without error_description (if you know the problem)

---

## Quick Reference Table

| Need | Use Command | Example |
|------|-------------|---------|
| üêõ **Fix crash** | `/debug [file] [error]` | `/debug LoginFeature.swift App crashes on login` |
| üìñ **Understand code** | `/explain [file]` | `/explain RouteListUseCase.swift` |
| ‚úÖ **Pre-commit check** | `/lint [file]` | `/lint HomeFeature.swift` |
| üöÄ **Fix performance** | `/optimize [file] [goal]` | `/optimize RouteListView.swift fix scrolling lag` |
| üèóÔ∏è **Improve architecture** | `/refactor [file] [goal]` | `/refactor SettingsFeature.swift extract use case` |

---

## Related Documentation

- See `CLAUDE.md` for project architecture patterns and TCA best practices
- See `.claude/agents/` for specialized agent descriptions:
  - `tca-developer.md` - TCA patterns (State, Action, Reducer, Effects)
  - `ios-architect.md` - Clean Architecture (Use Cases, Services, Repositories)
  - `ios-swiftui-designer.md` - Design system (Colors, L10n, accessibility)

---

**Pro Tip:** Commands work best when you provide specific context. The more details you give about what you're trying to achieve, the better the analysis and suggestions will be!
