# Folder `features/`

Folder zawierający wszystkie funkcjonalności aplikacji w architekturze feature-based (modular monolith). Każdy feature jest niezależnym modułem z własną logiką biznesową, komponentami UI i testami.

## Struktura feature'a

Każdy folder reprezentuje jeden feature i zazwyczaj zawiera:

### Standardowa struktura
- **`actions/`** - Server Actions dla Next.js (funkcje wywoływane z klienta)
- **`components/`** - Komponenty React/UI dla feature'a
- **`logic/`** - Logika biznesowa (use cases, repos, types)
  - `*-use-case.ts` - Use cases (biznesowa logika aplikacji)
  - `*-repo.ts` - Repositories (dostęp do danych - API, CMS, localStorage)
  - `*-type.ts` - TypeScript types/DTOs dla feature'a
- **`__tests__/`** - Testy jednostkowe dla feature'a

## Lista feature'ów

### Core Features

#### `analytics/`
Integracja z narzędziami analitycznymi.
- **Komponenty**: Google Analytics, Plausible Analytics
- **Przeznaczenie**: Tracking użytkowników i wydarzeń

#### `bucket/`
Koszyk zakupowy (shopping cart).
- **Use cases**: Dodawanie/usuwanie produktów, aktualizacja ilości, czyszczenie koszyka
- **Storage**: LocalStorage
- **Komponenty**: Lista produktów w koszyku, podsumowanie koszyka

#### `checkout/`
Proces płatności i finalizacji zamówienia.
- **Use cases**: PayU payment integration, tworzenie zamówień, pobieranie plików
- **API Routes**: `/api/checkout/download`, `/api/checkout/continue`
- **Komponenty**: Formularz checkout, sekcje: adres, kontakt, płatność, podsumowanie
- **Integracje**: PayU (bramka płatności)

#### `confirmation/`
Potwierdzenie zamówienia po płatności.
- **Przeznaczenie**: Wyświetlanie informacji o zamówieniu po udanej płatności
- **Komponenty**: Karta potwierdzenia

#### `survey/`
Integracja z Tally.so (ankiety).
- **Typy**: Kompletne definicje Tally webhook payload, wszystkie typy pól ankiety
- **Komponenty**: Survey CTA Section
- **API**: Webhook endpoint (`/api/survey/webhook`)
- **Strony**: `/survey`, `/survey/thank-you`, `/survey/approved`, `/survey/rejected`

### Layout & Navigation

#### `layout/`
Komponenty layoutu aplikacji.
- **`footer/`** - Stopka witryny (warianty: minimal, full)
- **`navigation/`** - Nawigacja (desktop, mobile, burger menu)
- **`section-contact/`** - Sekcja kontaktowa (desktop/mobile variants)
- **`slider/`** - Slider z referencjami/projektami

### Legal & Content

#### `legal/`
Ogólna obsługa dokumentów prawnych.
- **Komponenty**: Legal content renderer
- **Use cases**: Pobieranie dokumentów prawnych z CMS

#### `privacy-policy/`
Polityka prywatności.
- **Strona**: `/polityka-prywatnosci`
- **Data source**: CMS

#### `terms-and-conditions/`
Regulamin.
- **Strona**: `/regulamin`
- **Data source**: CMS

### Utilities

#### `consent-cookie/`
Cookie consent banner (RODO/GDPR).
- **Przeznaczenie**: Zarządzanie zgodami na cookies
- **Storage**: LocalStorage

#### `seo/`
SEO i metadata.
- **Use cases**: Pobieranie SEO metadata z CMS
- **Komponenty**: JSON-LD scripts
- **Przeznaczenie**: Dynamiczne generowanie metadanych dla stron

#### `common/`
Współdzielone utilities i typy.
- **Pliki**:
  - `common-dtos.ts` - Wspólne DTOs
  - `common-repos.ts` - Wspólne repositories
  - `common-server-repos.ts` - Server-side repositories
  - `common-types.ts` - Wspólne typy TypeScript
  - `common-use-cases.ts` - Wspólne use cases

## Architektura

### Clean Architecture Layers
1. **Actions** - Entry point (Next.js Server Actions)
2. **Use Cases** - Business logic (pure functions)
3. **Repositories** - Data access (API, CMS, localStorage, database)
4. **Types/DTOs** - Data Transfer Objects

### Dependency Injection
Use cases przyjmują dependencies przez parametr `context`, co ułatwia testowanie:

```typescript
async function someUseCase({
  context,
  data
}: {
  context: { getProducts: GetProducts }
  data: { id: string }
})
```

### Error Handling
Projekt używa własnego systemu obsługi błędów:
- `ClientResult<T>` - Result type dla operacji
- `clientValue()`, `clientError()` - Constructors
- `execute()`, `executePromise()` - Wrappers dla bezpiecznego wykonywania kodu

### Testing
- Każdy feature ma własny folder `__tests__/`
- Test utilities w plikach `*-test-utils.ts`
- Testy dla: actions, use cases, repositories

## Konwencje nazewnictwa

- **Components**: PascalCase (np. `CheckoutForm`)
- **Files**: kebab-case (np. `checkout-use-case.ts`)
- **Types/DTOs**: PascalCase z sufiksem `DTO` (np. `CheckoutDTO`)
- **Use cases**: camelCase z sufiksem `UseCase` (np. `payuPaymentUseCase`)
- **Repositories**: camelCase z prefiksem action (np. `fetchProducts`, `createOrder`)

## Data Sources
- **CMS** - Strapi (treści, SEO, layout data)
- **LocalStorage** - Koszyk, cookie consent
- **External APIs** - PayU, Tally.so
- **Database** - Zamówienia, dane płatności
