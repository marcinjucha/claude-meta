# Migrate to TCA + Clean Architecture

Migrate legacy iOS code to TCA and Clean Architecture patterns:

**Legacy View Model → Modern Screen Logic:**
- Convert old observable pattern to modern state management
- Extract properties to proper state
- Convert methods to actions
- Migrate data subscriptions to modern effects
- Add proper dependency management
- Implement bindings for forms

**Direct API Calls → Data Layer:**
- Extract network calls to data layer
- Abstract data access behind interface
- Add local persistence if needed
- Return reactive data streams

**Business Logic → Proper Layer:**
- Extract validation to business layer
- Move data orchestration to business layer
- Create services if combining multiple data sources

**View Updates:**
- Update to modern SwiftUI patterns
- Simplify bindings
- Add proper action handling
- Remove business logic from views

**Testing Infrastructure:**
- Generate TestStore tests
- Create makeWithDeps factory
- Mock dependencies with testValue

**Preserves:**
- Existing functionality
- UI layout and design
- Business logic behavior

Provides step-by-step migration plan with before/after code examples.

**Agent Used:** May invoke `tca-developer` and `ios-architect`.

**Relevant Cursor Rules:**
- `architecture-essentials.mdc` - Clean Architecture layer organization
- `tca-essentials.mdc` - Modern TCA patterns and state management

**Creating Custom Agents/Rules:**
If you need specialized context for this workflow:

*Agent (Claude Code):*
1. Use chat + documentation/files to create agent content
2. Run `/agents > Create new agent` to save
3. Add natural language triggers

*Rule (Cursor AI):*
1. Use chat + documentation/files (@Web, @Docs) to create rule content
2. Run `/Generate Cursor Rules` to save
3. Configure globs pattern and semantic matching

## Usage
```
/migration [file_path] [migration_type]
```

## Parameters
- `file_path`: Path to the legacy file to migrate (required)
- `migration_type`: Optional specific migration (e.g., "ViewModel to TCA", "extract Use Case", "add Repository")
