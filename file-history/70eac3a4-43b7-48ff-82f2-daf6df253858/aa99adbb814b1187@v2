// Copyright Â© 2024 Scandit. All rights reserved.

import ComposableArchitecture
import UIKit

protocol AnyMappingModeModulePreviewUseCase {
    func loadModulePreview(moduleId: Int) async throws -> (cached: UIImage?, fresh: Task<UIImage, Error>)
}

final class MappingModeModulePreviewUseCase: AnyMappingModeModulePreviewUseCase {
    @Dependency(\.modulePreviewRepository)
    private var previewRepository: ModulePreviewRepository

    func loadModulePreview(moduleId: Int) async throws -> (cached: UIImage?, fresh: Task<UIImage, Error>) {
        return try await previewRepository.preview(forModuleId: moduleId)
    }
}

#if DEBUG
extension MappingModeModulePreviewUseCase {
    static func makeWithDeps(
        previewRepository: ModulePreviewRepository
    ) -> MappingModeModulePreviewUseCase {
        withDependencies {
            $0.modulePreviewRepository = previewRepository
        } operation: {
            MappingModeModulePreviewUseCase()
        }
    }
}
#endif
