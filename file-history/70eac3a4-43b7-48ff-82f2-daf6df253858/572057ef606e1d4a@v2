//  Copyright Â© 2025 Scandit. All rights reserved.

@testable import DigitalShelf
import UIKit

final class MappingModeModulePreviewUseCaseSpy: AnyMappingModeModulePreviewUseCase {

    // MARK: - Properties

    var invokedLoadModulePreviewCount = 0
    var invokedLoadModulePreviewParameters: Int?
    var invokedLoadModulePreviewParametersList = [Int]()
    var stubbedCachedImage: UIImage?
    var stubbedFreshImage: UIImage?
    var stubbedError: Error?

    // MARK: - Methods

    func loadModulePreview(moduleId: Int) async throws -> (cached: UIImage?, fresh: Task<UIImage, Error>) {
        invokedLoadModulePreviewCount += 1
        invokedLoadModulePreviewParameters = moduleId
        invokedLoadModulePreviewParametersList.append(moduleId)

        if let error = stubbedError {
            throw error
        }

        let freshTask = Task<UIImage, Error> {
            if let image = self.stubbedFreshImage {
                return image
            }
            throw MappingModulePreviewTestError.noImageConfigured
        }

        return (cached: stubbedCachedImage, fresh: freshTask)
    }

    // MARK: - Helper Methods

    func reset() {
        invokedLoadModulePreviewCount = 0
        invokedLoadModulePreviewParameters = nil
        invokedLoadModulePreviewParametersList.removeAll()
        stubbedCachedImage = nil
        stubbedFreshImage = nil
        stubbedError = nil
    }
}

// MARK: - Test Error

enum MappingModulePreviewTestError: Error {
    case noImageConfigured
}
