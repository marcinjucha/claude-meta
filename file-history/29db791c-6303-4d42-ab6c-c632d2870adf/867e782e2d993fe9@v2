import { ClientResult } from "@/lib/error-handling"

export type SurveyResultDTO = {
  id: string
  email?: string
  result: SurveyResult
  submittedAt: string
  tallyResponseId?: string
}

export type SurveyResult = "approved" | "rejected"

export type CreateSurveyResultDTO = {
  email?: string
  result: SurveyResult
  tallyResponseId?: string
}

// Tally webhook payload structure - kompletna definicja
export type TallyWebhookPayload = {
  eventId: string
  eventType: string
  createdAt: string
  data: {
    responseId: string
    submissionId: string
    respondentId: string
    formId: string
    formName: string
    createdAt: string
    fields: Array<TallyField>
  }
}

// Definicja pola Tally z wszystkimi możliwymi typami
export type TallyField = {
  key: string
  label: string
  type: TallyFieldType
  value: any
  options?: Array<{
    id: string
    text: string
  }>
  rows?: Array<{
    id: string
    text: string
  }>
  columns?: Array<{
    id: string
    text: string
  }>
}

// Wszystkie typy pól obsługiwane przez Tally
export type TallyFieldType =
  | "INPUT_TEXT"
  | "TEXTAREA"
  | "INPUT_EMAIL"
  | "INPUT_PHONE_NUMBER"
  | "INPUT_LINK"
  | "INPUT_DATE"
  | "INPUT_TIME"
  | "INPUT_NUMBER"
  | "MULTIPLE_CHOICE"
  | "CHECKBOXES"
  | "DROPDOWN"
  | "MULTI_SELECT"
  | "RATING"
  | "LINEAR_SCALE"
  | "RANKING"
  | "MATRIX"
  | "FILE_UPLOAD"
  | "SIGNATURE"
  | "PAYMENT"
  | "CALCULATED_FIELDS"
  | "HIDDEN_FIELDS"

// Typy wartości dla różnych pól - szczegółowe definicje
export type TallyFieldValue =
  | string
  | number
  | boolean
  | string[]
  | TallyFileUpload[]
  | TallyMatrixValue
  | TallyPaymentValue
  | null

// Typy dla konkretnych pól
export type TallyFileUpload = {
  id: string
  name: string
  url: string
  mimeType: string
  size: number
}

export type TallyMatrixValue = Record<string, string[]>

export type TallyPaymentValue = {
  price?: number
  currency?: string
  name?: string
  email?: string
  link?: string
}

export type TallyOption = {
  id: string
  text: string
}

export type TallyMatrixRow = {
  id: string
  text: string
}

export type TallyMatrixColumn = {
  id: string
  text: string
}

// Typy dla różnych rodzajów pól z konkretnymi wartościami
export type TallyTextField = {
  type:
    | "INPUT_TEXT"
    | "TEXTAREA"
    | "INPUT_EMAIL"
    | "INPUT_PHONE_NUMBER"
    | "INPUT_LINK"
    | "INPUT_DATE"
    | "INPUT_TIME"
  value: string
}

export type TallyNumberField = {
  type: "INPUT_NUMBER" | "RATING" | "LINEAR_SCALE"
  value: number
}

export type TallyChoiceField = {
  type: "MULTIPLE_CHOICE" | "DROPDOWN"
  value: string[]
  options: TallyOption[]
}

export type TallyMultiChoiceField = {
  type: "CHECKBOXES" | "MULTI_SELECT"
  value: string[] | boolean
  options?: TallyOption[]
}

export type TallyRankingField = {
  type: "RANKING"
  value: string[]
  options: TallyOption[]
}

export type TallyMatrixField = {
  type: "MATRIX"
  value: TallyMatrixValue
  rows: TallyMatrixRow[]
  columns: TallyMatrixColumn[]
}

export type TallyFileField = {
  type: "FILE_UPLOAD" | "SIGNATURE"
  value: TallyFileUpload[]
}

export type TallyPaymentField = {
  type: "PAYMENT"
  value: string | number
}

export type TallyHiddenField = {
  type: "CALCULATED_FIELDS" | "HIDDEN_FIELDS"
  value: string | number
}

// Union type dla wszystkich pól
export type TallyFieldUnion =
  | TallyTextField
  | TallyNumberField
  | TallyChoiceField
  | TallyMultiChoiceField
  | TallyRankingField
  | TallyMatrixField
  | TallyFileField
  | TallyPaymentField
  | TallyHiddenField

// Rozszerzona definicja pola z type guards
export type TallyFieldWithMeta = {
  key: string
  label: string
} & TallyFieldUnion

// Aliasy ClientResult
export type SurveyResultClientResult = ClientResult<SurveyResultDTO>

// CMS GraphQL Response Types
export type CreateSurveyResponse = {
  createSurvey: {
    documentId: string
    surveyID: string
    surveyContent: string
  }
}

export type GetSurveyResponse = {
  survey: {
    documentId: string
    surveyID: string
    surveyContent: string
  }
}

export type SurveyInput = {
  surveyID: string
  surveyContent: string
}
